<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8"/>
<title>PUPR • Radar Hujan (RainViewer) — Indonesia</title>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<style>
  :root{--H:58px;--T:56px;--bd:#eee;--r:12px;--shadow:0 6px 22px rgba(0,0,0,.08);--font:system-ui,Segoe UI,Roboto,Arial}
  html,body{height:100%;margin:0;font-family:var(--font)}
  #header{position:fixed;top:0;left:0;right:0;height:var(--H);
    display:flex;align-items:center;gap:10px;padding:6px 12px;background:#fff;
    border-bottom:1px solid var(--bd);font-weight:700;font-size:13px;z-index:900;line-height:1.2;text-align:center;justify-content:center}
  #header img{height:38px}
  .top{position:fixed;top:var(--H);left:0;right:0;height:var(--T);
    display:flex;align-items:center;gap:10px;flex-wrap:wrap;padding:8px 14px;
    background:#fff;border-bottom:1px solid var(--bd);z-index:900}
  .pill{padding:6px 10px;border:1px solid #dcdcdc;border-radius:999px;background:#fff;cursor:pointer}
  .pill:hover{background:#f6f6f6}
  #map{position:absolute;top:calc(var(--H) + var(--T));left:0;right:0;bottom:0}
  .infobox{position:absolute;left:10px;bottom:10px;background:rgba(255,255,255,.9);
    border:1px solid var(--bd);border-radius:var(--r);box-shadow:var(--shadow);
    padding:6px 8px;font-size:11px;z-index:800;max-width:300px}
  .panel{position:absolute;right:10px;bottom:60px;width:340px;
    background:rgba(255,255,255,.95);border:1px solid var(--bd);border-radius:var(--r);
    box-shadow:var(--shadow);padding:10px 12px;font-size:13px;z-index:800}
  .panel h3{margin:4px 0 8px}
  .legend{display:grid;grid-template-columns:auto 1fr;gap:6px 10px;align-items:center;margin-bottom:6px}
  .grad{height:14px;background:linear-gradient(90deg,#3a7bd5,#00d2ff,#00ff88,#ffee00,#ff7b00,#ff004c,#b800ff);border:1px solid #777;border-radius:6px}
  .anim{display:flex;align-items:center;gap:8px}
  input[type="range"]{width:140px}
  @media(max-width:720px){
    .panel{width:calc(100% - 20px);left:10px;right:10px;bottom:70px}
  }
</style>
</head>
<body>
<div id="header">
  <img src="https://iconape.com/wp-content/png_logo_vector/pu-logo.png" alt="">
  KEMENTERIAN PEKERJAAN UMUM DIREKTORAT JENDERAL SUMBER DAYA AIR  DIREKTORAT IRIGASI DAN RAWA
</div>

<div class="top">
  <button class="pill" id="btnReload">Reload Data</button>
  <div class="anim">
    <button class="pill" id="btnPlay">▶︎</button>
    <input id="frame" type="range" min="0" max="0" step="1" value="0"/>
    <span id="ts" style="font-size:12px;color:#666">—</span>
  </div>
</div>

<div id="map"></div>

<div class="infobox">
  <b>Sumber:</b> RainViewer Radar (global, update ~10 menit).<br/>
  <span style="color:#555">Kredit: © RainViewer • © OpenStreetMap</span>
</div>

<div class="panel">
  <h3>Legenda Radar</h3>
  <div class="legend">
    <div class="grad"></div>
    <div style="font-size:12px;color:#555">← ringan … sedang … lebat … sangat lebat →</div>
  </div>
  <div><b>Frame:</b> <span id="ts2" class="muted">—</span></div>
</div>

<script>
const map=L.map('map',{minZoom:3,maxZoom:18});
L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png',{attribution:'© OpenStreetMap'}).addTo(map);
map.fitBounds([[-11,94],[6,141]]); // extent Indonesia

let frames=[], frameIndex=0, animTimer=null, radarLayer=null;
async function loadFrames(){
  const url='https://api.rainviewer.com/public/weather-maps.json';
  const res=await fetch(url); const json=await res.json();
  frames=[...(json.radar.past||[]),...(json.radar.nowcast||[])].map(x=>x.time);
  if(!frames.length){alert("Tidak ada frame RainViewer");return;}
  frame.max=String(frames.length-1); setFrame(frames.length-1);
}
function frameUrl(t){return `https://tilecache.rainviewer.com/v2/radar/${t}/256/{z}/{x}/{y}/2/1_1.png`;}
function setFrame(idx){
  frameIndex=idx; frame.value=String(idx);
  const t=frames[idx]; const d=new Date(t*1000);
  const timeStr=d.toLocaleString('id-ID',{hour:'2-digit',minute:'2-digit',day:'2-digit',month:'short'});
  ts.textContent=timeStr; ts2.textContent=timeStr;
  if(radarLayer) map.removeLayer(radarLayer);
  radarLayer=L.tileLayer(frameUrl(t),{opacity:0.75,attribution:'© RainViewer'}).addTo(map);
}
frame.oninput=()=>setFrame(parseInt(frame.value,10));
btnPlay.onclick=()=>{
  if(animTimer){clearInterval(animTimer);animTimer=null;btnPlay.textContent='▶︎';return;}
  btnPlay.textContent='⏸';animTimer=setInterval(()=>{
    let next=frameIndex+1; if(next>=frames.length) next=0;
    setFrame(next);
  },600);
};
btnReload.onclick=loadFrames;
loadFrames();
</script>
</body>
</html>
