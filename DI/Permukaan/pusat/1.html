<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebGIS PMTiles - DI Pusat</title>
    
    <script src="https://unpkg.com/maplibre-gl@3.x/dist/maplibre-gl.js"></script>
    <link href="https://unpkg.com/maplibre-gl@3.x/dist/maplibre-gl.css" rel="stylesheet" />
    
    <script src="https://unpkg.com/pmtiles@2.11.0/dist/index.js"></script>

    <style>
        body { margin: 0; padding: 0; font-family: sans-serif; }
        #map { position: absolute; top: 0; bottom: 0; width: 100%; }
        
        /* Panel Kontrol Layer & Legenda */
        .map-overlay {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.9);
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 0 15px rgba(0,0,0,0.2);
            z-index: 1;
            width: 200px;
        }
        .map-overlay h3 { margin: 0 0 10px; font-size: 16px; }
        .layer-item { margin-bottom: 8px; display: flex; align-items: center; cursor: pointer; }
        .legend-key {
            width: 20px;
            height: 12px;
            display: inline-block;
            margin-right: 10px;
            border: 1px solid #666;
        }
    </style>
</head>
<body>

<div id="map"></div>

<div class="map-overlay">
    <h3>Legenda & Layer</h3>
    <div class="layer-item">
        <input type="checkbox" id="layer-baku" checked>
        <span class="legend-key" style="background-color: #00ff00;"></span>
        <label for="layer-baku">Data Baku</label>
    </div>
    <div class="layer-item">
        <input type="checkbox" id="layer-fung" checked>
        <span class="legend-key" style="background-color: #0000ff;"></span>
        <label for="layer-fung">Data Fungsional</label>
    </div>
    <div class="layer-item">
        <input type="checkbox" id="layer-pots" checked>
        <span class="legend-key" style="background-color: #ffff00;"></span>
        <label for="layer-pots">Data Potensial</label>
    </div>
</div>

<script>
    // 1. Inisialisasi Protocol PMTiles dengan benar
    const p = new pmtiles.Protocol();
    maplibregl.addProtocol("pmtiles", p.tile);

    const map = maplibregl.Map({
        container: 'map',
        style: {
            version: 8,
            sources: {
                'imagery': {
                    'type': 'raster',
                    'tiles': ['https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}'],
                    'tileSize': 256,
                    'attribution': 'Esri'
                }
            },
            layers: [{ 'id': 'imagery', 'type': 'raster', 'source': 'imagery' }]
        },
        center: [96.7, 4.4], // Koordinat Aceh
        zoom: 8
    });

    map.on('load', () => {
        // --- DATA BAKU ---
        map.addSource('source-baku', {
            type: 'vector',
            // Gunakan path relatif atau absolute URL ke file .pmtiles
            url: "pmtiles://Aceh_Pusat_-_BWS_Sumatera_I_BAKU.pmtiles" 
        });
        map.addLayer({
            'id': 'layer-baku-viz',
            'type': 'fill',
            'source': 'source-baku',
            'source-layer': 'Aceh_Pusat_-_BWS_Sumatera_I_BAKU', // Pastikan nama layer sesuai
            'paint': { 'fill-color': '#00ff00', 'fill-opacity': 0.7 }
        });

        // --- DATA FUNGSIONAL ---
        map.addSource('source-fung', {
            type: 'vector',
            url: "pmtiles://Aceh_Pusat_-_BWS_Sumatera_I_FUNG.pmtiles"
        });
        map.addLayer({
            'id': 'layer-fung-viz',
            'type': 'fill',
            'source': 'source-fung',
            'source-layer': 'Aceh_Pusat_-_BWS_Sumatera_I_FUNG',
            'paint': { 'fill-color': '#0000ff', 'fill-opacity': 0.7 }
        });

        // --- DATA POTENSIAL ---
        map.addSource('source-pots', {
            type: 'vector',
            url: "pmtiles://Aceh_Pusat_-_BWS_Sumatera_I_POTS.pmtiles"
        });
        map.addLayer({
            'id': 'layer-pots-viz',
            'type': 'fill',
            'source': 'source-pots',
            'source-layer': 'Aceh_Pusat_-_BWS_Sumatera_I_POTS',
            'paint': { 'fill-color': '#ffff00', 'fill-opacity': 0.7 }
        });

        // Kontrol On/Off
        const setupToggle = (id, layerId) => {
            document.getElementById(id).addEventListener('change', (e) => {
                map.setLayoutProperty(layerId, 'visibility', e.target.checked ? 'visible' : 'none');
            });
        };
        setupToggle('layer-baku', 'layer-baku-viz');
        setupToggle('layer-fung', 'layer-fung-viz');
        setupToggle('layer-pots', 'layer-pots-viz');
    });
</script>

</body>
</html>
