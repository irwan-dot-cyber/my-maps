<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>PMTiles Viewer</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

<style>
html,body{height:100%;margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto}
#map{height:100%;width:100%}

/* === PANEL MINI (MOBILE-FIRST) === */
.panel{
  position:absolute;z-index:999;
  top:10px;left:10px;
  background:#0f172aee;color:#e5e7eb;
  border-radius:12px;
  padding:10px;
  display:flex;
  gap:8px;
  box-shadow:0 10px 25px rgba(0,0,0,.35)
}
.item{
  display:flex;align-items:center;gap:6px;
  font-size:12px;font-weight:600
}
.dot{width:10px;height:10px;border-radius:50%}
.baku{background:#3b82f6}
.pots{background:#f59e0b}
.fung{background:#10b981}

/* === LOADING CENTER === */
#loading{
  position:absolute;z-index:2000;
  inset:0;
  display:flex;
  align-items:center;
  justify-content:center;
  background:rgba(15,23,42,.55);
  color:#fff;
  font-size:18px;
  font-weight:700;
  letter-spacing:.5px
}
</style>
</head>

<body>
<div id="map"></div>

<!-- MINI LEGEND -->
<div class="panel">
  <label class="item">
    <span class="dot baku"></span>
    <input type="checkbox" checked id="baku">BAKU
  </label>
  <label class="item">
    <span class="dot pots"></span>
    <input type="checkbox" checked id="pots">POTENSIAL
  </label>
  <label class="item">
    <span class="dot fung"></span>
    <input type="checkbox" checked id="fung">FUNGSIONAL
  </label>
</div>

<!-- LOADING -->
<div id="loading">Loading dataâ€¦</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://unpkg.com/pmtiles@3.0.7/dist/pmtiles.js"></script>
<script src="https://unpkg.com/protomaps-leaflet@4.0.1/dist/protomaps-leaflet.js"></script>

<script>
const map = L.map("map",{preferCanvas:true}).setView([-2.5,118],5);

// Basemap imagery
L.tileLayer(
  "https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",
  {maxZoom:20}
).addTo(map);

const groups = {
  BAKU: L.layerGroup().addTo(map),
  POTENSIAL: L.layerGroup().addTo(map),
  FUNGSIONAL: L.layerGroup().addTo(map)
};

function polygonRules(color){
  return [{
    symbolizer:new protomapsL.PolygonSymbolizer({
      fill:color,
      stroke:"rgba(0,0,0,0)",
      width:0
    })
  }];
}

async function loadManifest(){
  const res = await fetch("manifest.json");
  const json = await res.json();
  const items = json.layers;

  for(const it of items){
    const pm = new pmtiles.PMTiles(it.file);
    const meta = await pm.getMetadata();

    const rules =
      it.category==="BAKU" ? polygonRules("rgba(59,130,246,.35)") :
      it.category==="POTENSIAL" ? polygonRules("rgba(245,158,11,.35)") :
      polygonRules("rgba(16,185,129,.35)");

    const layer = protomapsL.leafletLayer({
      url: it.file,
      paintRules: rules
    });

    layer.addTo(groups[it.category]);
  }

  document.getElementById("loading").style.display="none";
}

loadManifest();

// Toggle
baku.onchange = ()=> baku.checked ? map.addLayer(groups.BAKU) : map.removeLayer(groups.BAKU);
pots.onchange = ()=> pots.checked ? map.addLayer(groups.POTENSIAL) : map.removeLayer(groups.POTENSIAL);
fung.onchange = ()=> fung.checked ? map.addLayer(groups.FUNGSIONAL) : map.removeLayer(groups.FUNGSIONAL);
</script>
</body>
</html>
