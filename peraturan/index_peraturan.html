<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Regulasi: Irigasi, Ketahanan & Swasembada Pangan</title>
  <meta name="description" content="Daftar peraturan (UU, PP, Perpres/Keppres/Inpres, Permen, Bapanas, Perda) terkait irigasi, ketahanan pangan, dan swasembada. Data otomatis dari JSON."/>
  <link rel="icon" href="../assets/LogoPUPR.png" />

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme:{extend:{
        fontFamily:{sans:['Inter','ui-sans-serif','system-ui']},
        colors:{survey:'#0d47a1',surveyDark:'#0a3a85',surveyLight:'#1d5fd1'},
        boxShadow:{header:'0 4px 14px rgba(13,71,161,.18)'}
      }}
    }
  </script>

  <style>
    html{scroll-behavior:smooth}
    :focus-visible{outline:2px solid #1d5fd1;outline-offset:2px}
    .tag{font-size:.72rem;padding:.15rem .5rem;border-radius:9999px;border:1px solid rgba(255,255,255,.18)}
    .card{border:1px solid rgba(255,255,255,.12);background:rgba(255,255,255,.06);backdrop-filter:blur(6px)}
    .badge-irwan{
      position:fixed; right:16px; bottom:12px; z-index:80;
      background:rgba(13,71,161,.85);
      border:1px solid rgba(255,255,255,.25);
      color:#fff; font-size:13px; font-weight:700;
      padding:6px 12px; border-radius:10px;
      box-shadow:0 0 10px rgba(13,71,161,.6);
      backdrop-filter:blur(6px);
      animation:glow 2.8s ease-in-out infinite;
    }
    .badge-irwan span{ color:#FFD700; }
    @keyframes glow{ 0%,100%{ box-shadow:0 0 8px rgba(13,71,161,.6);} 50%{ box-shadow:0 0 18px rgba(255,215,0,.8);} }
  </style>
</head>
<body class="font-sans antialiased bg-[#0b1222] text-slate-100">

  <!-- Header -->
  <header class="sticky top-0 z-40 bg-survey text-white shadow-[0_6px_24px_rgba(0,0,0,.25)]">
    <div class="max-w-7xl mx-auto px-4 py-3 flex items-center justify-between">
      <a href="../si-irwan.html" class="flex items-center gap-3">
        <img src="../assets/LogoPUPR.png" class="w-9 h-9" alt="PUPR"/>
        <div class="leading-tight">
          <div class="text-xs uppercase tracking-wide text-white/80">Kementerian Pekerjaan Umum</div>
          <div class="font-semibold">Direktorat Jenderal Sumber Daya Air</div>
          <div class="text-xs text-white/80">Direktorat Irigasi & Rawa</div>
        </div>
      </a>
      <a href="../si-irwan.html" class="text-sm bg-white text-survey px-3 py-2 rounded-lg font-semibold hover:bg-white/90 transition">
        Beranda
      </a>
    </div>
  </header>

  <!-- Hero -->
  <section class="bg-gradient-to-b from-[#0b1222] via-[#0b1222]/60 to-transparent">
    <div class="max-w-7xl mx-auto px-4 py-8">
      <h1 class="text-2xl md:text-3xl font-extrabold">Regulasi: Irigasi, Ketahanan & Swasembada Pangan</h1>
      </div>
  </section>

  <!-- Toolbar -->
  <section class="py-4">
    <div class="max-w-7xl mx-auto px-4">
      <div class="flex flex-col md:flex-row md:items-center gap-3">
        <div class="flex-1">
          <input id="q" type="search" placeholder="Cari … (mis. ‘irigasi’, ‘pangan’, ‘PLP2B’, ‘P3-TGAI’, ‘cadangan’)"
            class="w-full px-4 py-3 rounded-xl border border-white/10 bg-white/10 placeholder:text-slate-400 text-white"/>
        </div>

        <!-- Filter Kelompok -->
        <label class="inline-flex items-center gap-2 text-sm"><input id="flt-uu" type="checkbox" class="h-4 w-4 accent-slate-100" checked><span>UU</span></label>
        <label class="inline-flex items-center gap-2 text-sm"><input id="flt-pp" type="checkbox" class="h-4 w-4 accent-slate-100" checked><span>PP</span></label>
        <label class="inline-flex items-center gap-2 text-sm"><input id="flt-perpres" type="checkbox" class="h-4 w-4 accent-slate-100" checked><span>Perpres/Keppres/Inpres</span></label>
        <label class="inline-flex items-center gap-2 text-sm"><input id="flt-permen" type="checkbox" class="h-4 w-4 accent-slate-100" checked><span>Permen (PUPR/Pertanian)</span></label>
        <label class="inline-flex items-center gap-2 text-sm"><input id="flt-bapanas" type="checkbox" class="h-4 w-4 accent-slate-100" checked><span>Bapanas</span></label>
        <label class="inline-flex items-center gap-2 text-sm"><input id="flt-perda" type="checkbox" class="h-4 w-4 accent-slate-100" checked><span>Perda</span></label>

        <button id="reset" class="px-4 py-3 rounded-xl border border-white/15 text-white/90 hover:text-white">Reset</button>
      </div>

      <div class="mt-3 text-sm text-slate-300" id="countInfo">Memuat…</div>
    </div>
  </section>

  <!-- Grid -->
  <section class="py-6">
    <div class="max-w-7xl mx-auto px-4 grid lg:grid-cols-2 gap-4">

      <!-- UU -->
      <div class="card rounded-2xl p-4">
        <div class="flex items-center justify-between mb-2">
          <h2 class="text-base font-bold">📜 Undang-Undang <span id="count-uu" class="text-slate-300 font-normal"></span></h2>
          <span class="text-xs text-slate-300">Terbaru → Lama</span>
        </div>
        <ul id="list-uu" class="space-y-3 text-sm"></ul>
      </div>

      <!-- PP -->
      <div class="card rounded-2xl p-4">
        <div class="flex items-center justify-between mb-2">
          <h2 class="text-base font-bold">🏛️ Peraturan Pemerintah <span id="count-pp" class="text-slate-300 font-normal"></span></h2>
          <span class="text-xs text-slate-300">Terbaru → Lama</span>
        </div>
        <ul id="list-pp" class="space-y-3 text-sm"></ul>
      </div>

      <!-- Perpres/Keppres/Inpres -->
      <div class="card rounded-2xl p-4">
        <div class="flex items-center justify-between mb-2">
          <h2 class="text-base font-bold">🕊️ Perpres / Keppres / Inpres <span id="count-perpres" class="text-slate-300 font-normal"></span></h2>
          <span class="text-xs text-slate-300">Terbaru → Lama</span>
        </div>
        <ul id="list-perpres" class="space-y-3 text-sm"></ul>
      </div>

      <!-- Permen -->
      <div class="card rounded-2xl p-4">
        <div class="flex items-center justify-between mb-2">
          <h2 class="text-base font-bold">🧩 Peraturan Menteri (PUPR & Pertanian) <span id="count-permen" class="text-slate-300 font-normal"></span></h2>
          <span class="text-xs text-slate-300">Terbaru → Lama</span>
        </div>
        <ul id="list-permen" class="space-y-3 text-sm"></ul>
      </div>

      <!-- Bapanas -->
      <div class="card rounded-2xl p-4">
        <div class="flex items-center justify-between mb-2">
          <h2 class="text-base font-bold">🏷️ Peraturan Badan Pangan Nasional <span id="count-bapanas" class="text-slate-300 font-normal"></span></h2>
          <span class="text-xs text-slate-300">Terbaru → Lama</span>
        </div>
        <ul id="list-bapanas" class="space-y-3 text-sm"></ul>
      </div>

      <!-- Perda -->
      <div class="card rounded-2xl p-4">
        <div class="flex items-center justify-between mb-2">
          <h2 class="text-base font-bold">🏙️ Peraturan Daerah <span id="count-perda" class="text-slate-300 font-normal"></span></h2>
        <span class="text-xs text-slate-300">Terbaru → Lama</span>
        </div>
        <ul id="list-perda" class="space-y-3 text-sm"></ul>
      </div>

    </div>
  </section>

  <footer class="border-t border-white/10 mt-10">
    <div class="max-w-7xl mx-auto px-4 py-8 text-sm text-slate-300 flex items-center justify-between">
      <span>© 2025 Direktorat Irigasi & Rawa</span>
      <span id="last-updated" class="opacity-80"></span>
    </div>
  </footer>

  <!-- Badge Si-Irwan -->
  <div class="badge-irwan" title="Sistem Informasi Irigasi & Rawa Nasional">
    <span>Si-Irwan v1.0</span>
  </div>

  <script>
    // ===== util render item
    const makeItemHTML = (it) => {
      const tags = (it.tags||[]).map(t=>`<span class="tag">${t}</span>`).join('');
      const lead = it.number ? `${it.level} ${it.number}/${it.year}` : `${it.level} ${it.year}`;
      const meta = it.note ? ` <span class="text-slate-300">— ${it.note}</span>` : '';
      const linkAttr = it.link ? `href="${it.link}" target="_blank" rel="noopener"` : `href="#"`;
      return `
        <li class="item" data-cat="${it.group}" data-tags="${(it.tags||[]).join(' ').toLowerCase()}">
          <a class="block hover:underline font-semibold text-sky-300 hover:text-white" ${linkAttr}>
            ${lead} — ${it.title}${meta}
          </a>
          <div class="mt-1 flex flex-wrap gap-2">${tags}</div>
        </li>
      `;
    };

    // ===== state
    const q = document.getElementById('q');
    const flt = {
      uu: document.getElementById('flt-uu'),
      pp: document.getElementById('flt-pp'),
      perpres: document.getElementById('flt-perpres'),
      permen: document.getElementById('flt-permen'),
      bapanas: document.getElementById('flt-bapanas'),
      perda: document.getElementById('flt-perda'),
    };
    const lists = {
      uu: document.getElementById('list-uu'),
      pp: document.getElementById('list-pp'),
      perpres: document.getElementById('list-perpres'),
      permen: document.getElementById('list-permen'),
      bapanas: document.getElementById('list-bapanas'),
      perda: document.getElementById('list-perda'),
    };
    const counts = {
      uu: document.getElementById('count-uu'),
      pp: document.getElementById('count-pp'),
      perpres: document.getElementById('count-perpres'),
      permen: document.getElementById('count-permen'),
      bapanas: document.getElementById('count-bapanas'),
      perda: document.getElementById('count-perda'),
    };

    const countInfo = document.getElementById('countInfo');
    const lastUpdated = document.getElementById('last-updated');

    // ===== render
    let ALL = []; // flattened array for search/filter

    function render(data){
      // clear
      Object.values(lists).forEach(ul => ul.innerHTML = '');

      // sort each group by year desc
      const mapKey = { uu:'UU', pp:'PP', perpres:'PERPRES', permen:'PERMEN', bapanas:'BAPANAS', perda:'PERDA' };

      for(const g of Object.keys(lists)){
        const arr = (data[mapKey[g]]||[]).slice().sort((a,b)=> (b.year||0)-(a.year||0));
        arr.forEach(it=>{
          it.group = g;
          it.level = it.level || (mapKey[g]||g).toUpperCase();
          lists[g].insertAdjacentHTML('beforeend', makeItemHTML(it));
        });
      }

      // flatten for filtering
      ALL = Array.from(document.querySelectorAll('.item'));
      applyFilter();

      // footer last updated
      const meta = data._meta;
      lastUpdated.textContent = 'Terakhir diperbarui: ' + (meta?.last_updated || new Date().toLocaleString('id-ID',{dateStyle:'medium', timeStyle:'short'}));
    }

    function applyFilter(){
      const text = (q.value||'').toLowerCase().trim();
      const show = {
        uu: flt.uu.checked,
        pp: flt.pp.checked,
        perpres: flt.perpres.checked,
        permen: flt.permen.checked,
        bapanas: flt.bapanas.checked,
        perda: flt.perda.checked,
      };
      let c = {uu:0, pp:0, perpres:0, permen:0, bapanas:0, perda:0}, total=0;

      ALL.forEach(li=>{
        const cat = li.dataset.cat;
        const tags = li.dataset.tags||'';
        const title = (li.querySelector('a')?.textContent||'').toLowerCase();
        let visible = !!show[cat];
        if(text && !(title.includes(text)||tags.includes(text))) visible=false;
        li.style.display = visible ? '' : 'none';
        if(visible){ c[cat]++; total++; }
      });

      counts.uu.textContent = `(${c.uu})`;
      counts.pp.textContent = `(${c.pp})`;
      counts.perpres.textContent = `(${c.perpres})`;
      counts.permen.textContent = `(${c.permen})`;
      counts.bapanas.textContent = `(${c.bapanas})`;
      counts.perda.textContent = `(${c.perda})`;
      countInfo.textContent = `Menampilkan ${total} regulasi`;
    }

    document.getElementById('reset').addEventListener('click', ()=>{
      q.value = '';
      Object.values(flt).forEach(cb=> cb.checked = true);
      applyFilter();
    });
    [q, ...Object.values(flt)].forEach(el=> el.addEventListener('input', applyFilter));

    // ===== load JSON dari folder yang sama
    fetch('regulasi.json', { cache:'no-store' })
      .then(r=>r.json())
      .then(render)
      .catch(err=>{
        countInfo.textContent = 'Gagal memuat regulasi.json — pastikan file ada di folder yang sama.';
        console.error(err);
      });
  </script>
</body>
</html>
