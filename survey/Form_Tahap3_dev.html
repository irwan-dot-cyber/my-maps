<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Riwayat Foto Progres (Slider)</title>
<style>
  :root{
    --bg:#0b1222; --panel:#0f172a; --card:#111b34;
    --text:#e5e7eb; --muted:#94a3b8; --line:#1f2a44;
    --ok:#22c55e; --warn:#f59e0b; --no:#64748b;
    --border:#18233d;
  }
  body{margin:0;font-family:Inter,system-ui,Segoe UI,Arial;background:var(--bg);color:var(--text);}
  .wrap{max-width:1100px;margin:24px auto;padding:0 16px;}
  .panel{background:linear-gradient(180deg,#0f172a,#0b1222);border:1px solid var(--border);
    border-radius:16px;padding:18px;box-shadow:0 12px 30px rgba(0,0,0,.35);}
  h2{margin:0 0 14px;font-size:18px;}
  .top{
    display:flex; gap:16px; align-items:center; flex-wrap:wrap;
    padding:12px; border:1px solid var(--border); border-radius:12px; background:rgba(255,255,255,.02);
  }
  .value{min-width:170px;display:flex;flex-direction:column;gap:4px}
  .value b{font-size:22px}
  .value small{color:var(--muted)}
  .sliderBox{flex:1; min-width:260px}
  input[type="range"]{width:100%}
  .marks{display:flex;justify-content:space-between;color:var(--muted);font-size:12px;margin-top:6px;}
  .rail{margin:16px 0 14px; display:flex; align-items:center; gap:10px;}
  .dot{width:14px;height:14px;border-radius:999px;border:2px solid var(--no);background:transparent}
  .dot.ok{border-color:var(--ok);background:rgba(34,197,94,.18)}
  .dot.now{border-color:var(--warn);box-shadow:0 0 0 6px rgba(245,158,11,.12)}
  .seg{flex:1;height:3px;background:var(--line);border-radius:99px;position:relative;overflow:hidden}
  .seg > i{position:absolute;inset:0; width:0%; background:rgba(245,158,11,.55)}
  .grid{display:grid;grid-template-columns:repeat(4,1fr);gap:12px;}
  @media (max-width: 980px){ .grid{grid-template-columns:repeat(2,1fr);} }
  @media (max-width: 520px){ .grid{grid-template-columns:1fr;} }

  .slot{
    border:1px solid var(--border); border-radius:14px; padding:12px;
    background:rgba(255,255,255,.02);
  }
  .slotHead{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;gap:10px;}
  .badge{
    font-size:12px; padding:6px 10px; border-radius:999px;
    border:1px solid var(--border); color:var(--muted); display:flex; align-items:center; gap:8px;
  }
  .lamp{width:10px;height:10px;border-radius:99px;background:var(--no)}
  .badge.ok .lamp{background:var(--ok)}
  .badge.now .lamp{background:var(--warn)}
  .badge.ok{color:var(--text)}
  .badge.now{color:var(--text)}
  .thumb{
    height:120px; border-radius:12px; border:1px dashed rgba(148,163,184,.35);
    display:flex; align-items:center; justify-content:center; overflow:hidden;
    background:rgba(0,0,0,.15);
  }
  .thumb img{width:100%;height:100%;object-fit:cover}
  .slotFoot{margin-top:10px; display:flex; gap:8px; align-items:center; justify-content:space-between; flex-wrap:wrap;}
  .meta{color:var(--muted); font-size:12px}
  .btn{
    cursor:pointer; border:1px solid var(--border); background:rgba(255,255,255,.03);
    color:var(--text); padding:8px 10px; border-radius:10px; font-size:12px;
  }
  .btn:hover{background:rgba(255,255,255,.06)}
  input[type="file"]{display:none}
</style>
</head>
<body>
<div class="wrap">
  <div class="panel">
    <h2>Riwayat Foto Progres</h2>

    <div class="top">
      <div class="value">
        <b id="pctText">24,4%</b>
        <small>Progres saat ini (0â€“100%)</small>
      </div>

      <div class="sliderBox">
        <input id="pct" type="range" min="0" max="100" step="0.1" value="24.4" />
        <div class="marks">
          <span>0</span><span>25</span><span>50</span><span>75</span><span>100</span>
        </div>
      </div>
    </div>

    <!-- indikator milestone -->
    <div class="rail" aria-label="milestone">
      <div id="d25" class="dot"></div>
      <div class="seg"><i id="s25"></i></div>
      <div id="d50" class="dot"></div>
      <div class="seg"><i id="s50"></i></div>
      <div id="d75" class="dot"></div>
      <div class="seg"><i id="s75"></i></div>
      <div id="d100" class="dot"></div>
    </div>

    <!-- 4 slot foto selalu terbuka -->
    <div class="grid" id="slots"></div>
  </div>
</div>

<script>
  const milestones = [
    { key:"p25",  label:"Foto Progres 25%",  m:25 },
    { key:"p50",  label:"Foto Progres 50%",  m:50 },
    { key:"p75",  label:"Foto Progres 75%",  m:75 },
    { key:"p100", label:"Foto Progres 100%", m:100 }
  ];

  const pct = document.getElementById('pct');
  const pctText = document.getElementById('pctText');

  // store dummy (bisa diganti localStorage / backend nanti)
  const state = {
    photos: { p25:null, p50:null, p75:null, p100:null },   // dataURL
    times:  { p25:null, p50:null, p75:null, p100:null }    // string
  };

  function fmtPct(v){
    // 24.4 -> "24,4%"
    const s = Number(v).toFixed(1).replace('.', ',');
    // buang .0 biar rapih
    return s.endsWith(',0') ? s.slice(0,-2) + '%' : s + '%';
  }

  function statusClass(current, m){
    // warna milestone: ok kalau >= m, now kalau paling dekat setelah nilai (opsional)
    if (current >= m) return 'ok';
    return '';
  }

  function renderSlots(){
    const el = document.getElementById('slots');
    const current = Number(pct.value);

    el.innerHTML = milestones.map(ms => {
      const img = state.photos[ms.key];
      const time = state.times[ms.key];
      const st = statusClass(current, ms.m);
      const badgeCls = st ? `badge ${st}` : 'badge';
      const badgeText = current >= ms.m ? 'Tercapai' : 'Belum';

      return `
        <div class="slot" data-key="${ms.key}">
          <div class="slotHead">
            <div style="font-weight:700">${ms.label}</div>
            <div class="${badgeCls}">
              <span class="lamp"></span>
              <span>${badgeText}</span>
            </div>
          </div>

          <div class="thumb">
            ${img ? `<img src="${img}" alt="${ms.label}">` : `<span style="color:var(--muted)">Belum ada foto</span>`}
          </div>

          <div class="slotFoot">
            <div class="meta">${time ? `Terakhir: ${time}` : `Belum upload`}</div>
            <div style="display:flex;gap:8px">
              <label class="btn">
                Upload
                <input type="file" accept="image/*" data-upload="${ms.key}">
              </label>
              <button class="btn" data-clear="${ms.key}">Hapus</button>
            </div>
          </div>
        </div>
      `;
    }).join('');
  }

  function updateMilestoneRail(){
    const current = Number(pct.value);
    // dot classes
    document.getElementById('d25').className  = 'dot ' + (current >= 25 ? 'ok' : '');
    document.getElementById('d50').className  = 'dot ' + (current >= 50 ? 'ok' : '');
    document.getElementById('d75').className  = 'dot ' + (current >= 75 ? 'ok' : '');
    document.getElementById('d100').className = 'dot ' + (current >= 100 ? 'ok' : '');

    // seg fill (antara milestone)
    const fill = (a,b) => {
      if (current <= a) return 0;
      if (current >= b) return 100;
      return ((current - a) / (b - a)) * 100;
    };
    document.getElementById('s25').style.width  = fill(0,25) + '%';
    document.getElementById('s50').style.width  = fill(25,50) + '%';
    document.getElementById('s75').style.width  = fill(50,75) + '%';

    // seg terakhir (75-100)
    document.getElementById('s75').parentElement.nextElementSibling?.querySelector('i')?.style;
    const lastSeg = document.querySelectorAll('.seg i')[3]; // i ke-4 ga ada, jadi aman? kita handle:
    const segs = document.querySelectorAll('.seg i');
    if (segs[3]) segs[3].style.width = fill(75,100) + '%'; // kalau kamu nambah seg 4 nanti
  }

  function updateHeader(){
    pctText.textContent = fmtPct(pct.value);
  }

  // events
  pct.addEventListener('input', () => {
    updateHeader();
    updateMilestoneRail();
    renderSlots();
  });

  document.addEventListener('change', (e) => {
    const inp = e.target;
    if (inp && inp.matches('input[type="file"][data-upload]')) {
      const key = inp.dataset.upload;
      const file = inp.files && inp.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = () => {
        state.photos[key] = reader.result;
        state.times[key] = new Date().toLocaleString('id-ID');
        renderSlots();
      };
      reader.readAsDataURL(file);
    }
  });

  document.addEventListener('click', (e) => {
    const btn = e.target;
    if (btn && btn.dataset && btn.dataset.clear) {
      const key = btn.dataset.clear;
      state.photos[key] = null;
      state.times[key] = null;
      renderSlots();
    }
  });

  // init
  updateHeader();
  updateMilestoneRail();
  renderSlots();
</script>
</body>
</html>
