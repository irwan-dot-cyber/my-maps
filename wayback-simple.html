<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8">
<title>Wayback Compare â€” Versi Pilihan</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
<style>
  html,body{height:100%;margin:0}
  #map{height:100%}
  /* Panel kontrol */
  #panel{
    position:absolute; z-index:1000; top:12px; left:50%;
    transform:translateX(-50%);
    display:flex; gap:10px; flex-wrap:wrap; align-items:center;
    background:rgba(255,255,255,.95); padding:8px 12px; border-radius:12px;
    box-shadow:0 4px 12px rgba(0,0,0,.2); font:600 12px system-ui,Segoe UI,Arial;
  }
  select, button{padding:6px 8px; font-size:12px}
  .sep{height:18px; width:1px; background:#ddd; margin:0 2px}
  /* Slider */
  #swipe{display:flex; align-items:center; gap:10px}
  #range{width:260px}
</style>
</head>
<body>
<div id="map"></div>

<!-- Panel: versi Before/After + slider -->
<div id="panel">
  <span>Before</span>
  <select id="beforeSel"></select>
  <span class="sep"></span>
  <span>After</span>
  <select id="afterSel"></select>
  <button id="applyBtn">Terapkan</button>
  <div class="sep"></div>
  <div id="swipe">
    <span>Slide:</span>
    <input id="range" type="range" min="0" max="100" value="50">
  </div>
</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
  // ====== 1) LOKASI CONTOH (ubah kalau perlu) ======
  const sample = {
    name: "Contoh Lokasi: D.I.R. Tanjung Sejaro",
    lat: -2.9681421, lng: 104.7309104, zoom: 15
  };

  // ====== 2) DAFTAR VERSI WAYBACK (tanggal YYYYMMDD) ======
  // Isi dengan versi yang tersedia di lokasi lo (cek di Wayback app)
  const WAYBACK_VERSIONS = [
    "20150702","20170705","20190716","20200122",
    "20210118","20220125","20230122","20240120","20240722"
  ];

  // ====== 3) URL TILE GENERATOR ======
  const makeUrl = (yyyymmdd) =>
    `https://wayback.maptiles.arcgis.com/arcgis/rest/services/World_Imagery/${yyyymmdd}/MapServer/tile/{z}/{y}/{x}`;

  // ====== 4) PETA ======
  const map = L.map('map').setView([sample.lat, sample.lng], sample.zoom);

  // ====== 5) ISI DROPDOWN ======
  const beforeSel = document.getElementById('beforeSel');
  const afterSel  = document.getElementById('afterSel');
  function fillSelect(sel, selected) {
    sel.innerHTML = "";
    WAYBACK_VERSIONS.forEach(v=>{
      const opt=document.createElement('option');
      opt.value=v; opt.textContent=v.slice(0,4)+"-"+v.slice(4,6)+"-"+v.slice(6,8);
      if(v===selected) opt.selected=true;
      sel.appendChild(opt);
    });
  }
  // default: before = lebih lama, after = terbaru
  fillSelect(beforeSel, WAYBACK_VERSIONS[2] || WAYBACK_VERSIONS[0]); // 2019
  fillSelect(afterSel , WAYBACK_VERSIONS[WAYBACK_VERSIONS.length-1]); // terbaru

  // ====== 6) LAYER & MARKER ======
  let leftLayer=null, rightLayer=null;
  const marker = L.marker([sample.lat, sample.lng]).addTo(map)
    .bindPopup(`
      <b>${sample.name}</b><br/>
      Koordinat: ${sample.lat.toFixed(6)}, ${sample.lng.toFixed(6)}<br/>
      <a href="https://www.google.com/maps?q=${sample.lat},${sample.lng}" target="_blank">Buka di Google Maps</a>
    `);

  function applyLayers(){
    // remove existing
    if(leftLayer)  map.removeLayer(leftLayer);
    if(rightLayer) map.removeLayer(rightLayer);

    const b = beforeSel.value;
    const a = afterSel.value;
    leftLayer  = L.tileLayer(makeUrl(b), {maxZoom:19, crossOrigin:true}).addTo(map);
    rightLayer = L.tileLayer(makeUrl(a), {maxZoom:19, crossOrigin:true}).addTo(map);
    // re-apply clip setelah tile kebuka
    rightLayer.on('load', applyClip);
    applyClip();
  }

  // ====== 7) SLIDER TANPA PLUGIN (clip layer kanan) ======
  const range = document.getElementById('range');
  function applyClip(){
    if(!rightLayer) return;
    const el = rightLayer.getContainer();
    if(!el) return;
    const p = Number(range.value)/100;
    const size = map.getSize();
    const clipW = Math.round(size.x * p);
    el.style.clipPath = `polygon(0 0, ${clipW}px 0, ${clipW}px ${size.y}px, 0 ${size.y}px)`;
    el.style.webkitClipPath = el.style.clipPath;
  }
  range.addEventListener('input', applyClip);
  map.on('resize zoom move', applyClip);

  // tombol Terapkan
  document.getElementById('applyBtn').addEventListener('click', applyLayers);

  // inisialisasi awal
  applyLayers();
  marker.openPopup();
</script>
</body>
</html>
