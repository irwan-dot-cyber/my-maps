<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Order Desain Kaos ‚Ä¢ List</title>
<style>
  :root{--bg:#0f1115;--card:#171922;--fg:#e8eefc;--muted:#9aa7c7;--line:#23283a}
  *{box-sizing:border-box} body{margin:0;background:#0f1115;color:var(--fg);font:500 15px/1.55 system-ui,Segoe UI,Inter,Arial}
  .wrap{max-width:1200px;margin:auto;padding:22px}
  h1{font:800 20px/1.2;margin:0}
  .formbox{background:#171922;border:1px solid var(--line);border-radius:12px;padding:12px;margin:16px 0;display:flex;flex-wrap:wrap;gap:12px;align-items:flex-start}
  .formbox input{flex:1;min-width:180px;padding:10px 12px;border-radius:8px;border:1px solid #26304f;background:#0f1320;color:var(--fg)}
  .btn{border:1px solid #26304f;background:#0f1320;color:#dce6ff;border-radius:10px;padding:10px 14px;cursor:pointer}
  .hint{font-size:12px;color:#9aa7c7;margin-top:-6px}
  .error{font-size:12px;color:#ff8a8a;margin-top:-6px;display:none}
  .oktag{display:none;align-items:center;gap:6px;background:#0c1f12;border:1px solid #1f5f3a;color:#b7ffd2;padding:6px 10px;border-radius:999px}
  .cartBtn{position:relative}
  .badge{display:none;position:absolute;top:-8px;right:-8px;background:#ef4444;color:#fff;border:2px solid #0f1320;border-radius:999px;font:700 11px/1 system-ui;padding:2px 6px}
  .card{background:#171922;border:1px solid var(--line);border-radius:14px;padding:10px 12px}
  .table{width:100%;border-collapse:collapse}
  .th,.td{padding:12px;border-bottom:1px solid var(--line);vertical-align:middle}
  .th{color:#aab6da;text-transform:uppercase;font-size:12px}
  .row:last-child .td{border-bottom:none}
  .no{width:56px;text-align:center}
  .title{font-weight:800}
  .thumb{width:120px;height:120px;border-radius:10px;overflow:hidden;background:#0e1018;border:1px solid #26304f;display:grid;place-items:center;cursor:pointer}
  .thumb img{width:100%;height:100%;object-fit:cover}
  .pick{text-align:center;width:90px}
  .backdrop{position:fixed;inset:0;background:rgba(0,0,0,.5);display:none;z-index:9000}
  .backdrop.show{display:block}
  .cart-panel{position:fixed;inset:0 0 0 auto;max-width:420px;transform:translateX(110%);transition:.25s;background:#0f1115;border-left:1px solid #26304f;z-index:9010;display:flex;flex-direction:column}
  .cart-panel.open{transform:translateX(0)}
  .cart-head{display:flex;align-items:center;justify-content:space-between;padding:14px;border-bottom:1px solid #26304f}
  .cart-body{padding:12px;overflow:auto;flex:1}
  .cart-row{display:grid;grid-template-columns:64px 1fr 70px;gap:10px;align-items:center;padding:10px 0;border-bottom:1px dashed #2b3350}
  .cart-thumb{width:64px;height:64px;border-radius:10px;overflow:hidden;border:1px solid #26304f;background:#101422}
  .cart-thumb img{width:100%;height:100%;object-fit:cover}
  .cart-foot{padding:12px;border-top:1px solid #26304f}
  .total{display:flex;align-items:center;justify-content:space-between;font-weight:800;margin-bottom:10px}
  .btn-primary{background:linear-gradient(135deg,#3b82f6,#22c55e);border:none;color:#fff;width:100%}
  .xbtn{cursor:pointer;color:#ff9b9b;border:1px solid #5b2b2b;background:#1a0d0d;border-radius:8px;padding:6px 8px;width:100%}
  .lightbox{position:fixed;inset:0;background:rgba(0,0,0,.88);display:none;align-items:center;justify-content:center;z-index:9500}
  .lightbox.show{display:flex}
  .lb-inner{position:relative;max-width:94vw}
  .lightbox .close{position:absolute;top:-48px;right:0;background:#1b2339;color:#eaf2ff;border:1px solid #2b3a66;border-radius:10px;padding:8px 12px;cursor:pointer}
  .lb-main{display:flex;align-items:center;gap:10px}
  .lb-main img{max-width:86vw;max-height:70vh;border-radius:12px}
  .nav{width:42px;height:42px;border-radius:999px;background:#1b2339;color:#eaf2ff;display:grid;place-items:center;cursor:pointer}
  .thumbs{display:flex;gap:8px;justify-content:center;margin-top:12px}
  .thumbs img{width:72px;height:72px;object-fit:cover;border-radius:8px;opacity:.7;cursor:pointer;border:2px solid transparent}
  .thumbs img.active{opacity:1;border-color:#3b82f6}
  .toast{position:fixed;top:14px;right:14px;background:#1b2339;color:#eaf2ff;padding:10px 14px;border-radius:10px;z-index:9600;opacity:0;transform:translateY(-10px);transition:.2s}
  .toast.show{opacity:1;transform:translateY(0)}
</style>
</head>
<body>
<div class="wrap">
  <h1>Order Desain Kaos</h1>
  <div class="formbox">
    <input id="nama" placeholder="Nama Pemesan"/>
    <input id="telp" placeholder="No. Telp / WA (10‚Äì15 digit angka)" inputmode="numeric"/>
    <div id="telpErr" class="error">No. telp salah</div>
    <button id="okBtn" type="button" class="btn">OK</button>
    <div id="okTag" class="oktag">‚úîÔ∏è Terverifikasi</div>
    <button id="cartBtn" type="button" class="btn cartBtn" style="margin-left:auto">üß∫ Keranjang <span id="cartBadge" class="badge">0</span></button>
  </div>
  <section class="card">
    <table class="table"><thead><tr><th>No</th><th>Judul</th><th>Gambar Belakang</th><th>Pilih</th></tr></thead><tbody id="tbody"></tbody></table>
  </section>
</div>

<div id="backdrop" class="backdrop"></div>
<aside id="cartPanel" class="cart-panel">
  <div class="cart-head"><strong>Pesanan</strong><button id="closeCart" type="button" class="btn">Tutup</button></div>
  <div id="cartBody" class="cart-body"></div>
  <div class="cart-foot"><div class="total"><span>Total</span><span id="grand">Rp 0</span></div><button id="submitBtn" type="button" class="btn btn-primary">Submit</button></div>
</aside>

<div id="lightbox" class="lightbox"><div class="lb-inner"><button class="close" id="lbClose">Tutup ‚úï</button><div class="lb-main"><div id="lbPrev" class="nav">‚ü®</div><img id="lbImg"><div id="lbNext" class="nav">‚ü©</div></div><div id="lbThumbs" class="thumbs"></div></div></div>
<div id="toast" class="toast"></div>

<script>
const SETS=[{id:"set-nothing",title:"Nothing is Imposible",logo:"./gambar/Nothing_Logo.png",back:"./gambar/Nothing_Back.png",mockup:"./gambar/Nothing_Mockup.png"}];
const PRICE=30000;
const SCRIPT_URL="https://script.google.com/macros/s/AKfycby20E4jQz5pGqSn0atadu1QGSVaUVXStt8GYiNnBlKvr-eyU-fz7cJJXRxxQqKkMLDSLw/exec"; // ganti
const WA_NUMBER="6281219929245"; // ganti

let USER_KEY=null,CONFIRMED=false;
const lsKey=()=>`orderCart_${USER_KEY}`,loadCart=()=>JSON.parse(localStorage.getItem(lsKey())||"{}"),saveCart=c=>localStorage.setItem(lsKey(),JSON.stringify(c));
const formatIDR=n=>new Intl.NumberFormat('id-ID',{style:'currency',currency:'IDR',maximumFractionDigits:0}).format(n);
const validTelp=t=>/^\d{10,15}$/.test(t);
function toast(m){const t=document.getElementById('toast');t.textContent=m;t.classList.add('show');setTimeout(()=>t.classList.remove('show'),1800);}
function updateBadge(){const b=document.getElementById('cartBadge');const c=(USER_KEY&&CONFIRMED)?Object.values(loadCart()).reduce((a,v)=>a+v.qty,0):0;b.style.display=c>0?'inline-block':'none';b.textContent=c;}

function imgsFor(s){const arr=[s.back];if(s.logo)arr.unshift(s.logo);if(s.mockup)arr.push(s.mockup);return arr.filter(Boolean);}
const tbody=document.getElementById("tbody");
function render(){const cart=(USER_KEY&&CONFIRMED)?loadCart():{};tbody.innerHTML="";let n=0;SETS.forEach(s=>{if(cart[s.id])return;n++;const d=!(USER_KEY&&CONFIRMED);const tr=document.createElement("tr");const imgs=imgsFor(s);tr.innerHTML=`<td>${n}</td><td>${s.title}</td><td><div class="thumb"><img src="${s.back}"></div></td><td><input type="checkbox" data-id="${s.id}" ${d?"disabled":""}></td>`;tbody.appendChild(tr);tr.querySelector(".thumb").onclick=()=>openLightbox(imgs,0);});tbody.querySelectorAll("input[type=checkbox]").forEach(cb=>cb.onchange=()=>{const id=cb.dataset.id;const c=loadCart();c[id]={qty:1,price:PRICE};saveCart(c);render();renderCart();updateBadge();toast("Ditambahkan");});}

const namaEl=document.getElementById("nama"),telpEl=document.getElementById("telp"),errEl=document.getElementById("telpErr");
okBtn.onclick=()=>{const n=namaEl.value.trim(),t=telpEl.value.trim();if(!n){toast("Isi nama");return;}if(!validTelp(t)){errEl.style.display="block";toast("Telp salah");return;}errEl.style.display="none";USER_KEY=n+"_"+t;CONFIRMED=true;okTag.style.display="inline-flex";render();updateBadge();};

const cartPanel=document.getElementById("cartPanel"),backdrop=document.getElementById("backdrop");
function openCart(){renderCart();cartPanel.classList.add("open");backdrop.classList.add("show");}
function closeCart(){cartPanel.classList.remove("open");backdrop.classList.remove("show");}
cartBtn.onclick=openCart;closeCartBtn=document.getElementById("closeCart");closeCartBtn.onclick=closeCart;backdrop.onclick=closeCart;

function renderCart(){const c=(USER_KEY)?loadCart():{};const body=document.getElementById("cartBody");body.innerHTML="";let tot=0;Object.entries(c).forEach(([id,v])=>{const s=SETS.find(x=>x.id===id);tot+=v.qty*v.price;body.innerHTML+=`<div class="cart-row"><div class="cart-thumb"><img src="${s.back}"></div><div>${s.title}<br>Qty: ${v.qty}</div><div><button class="xbtn" data-del="${id}">Hapus</button></div></div>`});document.getElementById("grand").textContent=formatIDR(tot);body.querySelectorAll("[data-del]").forEach(b=>b.onclick=()=>{const c=loadCart();delete c[b.dataset.del];saveCart(c);render();renderCart();updateBadge();});}

function sendToSheet(u,p){const blob=new Blob([JSON.stringify(p)],{type:'text/plain'});if(navigator.sendBeacon){navigator.sendBeacon(u,blob);return;}fetch(u,{method:'POST',mode:'no-cors',body:JSON.stringify(p)});}
function openWhatsApp(p,t){const num=String(p).replace(/\D/g,'');const urls=[`https://wa.me/${num}?text=${t}`,`https://api.whatsapp.com/send?phone=${num}&text=${t}`];for(const u of urls){const w=window.open(u,'_blank');if(w)return;}window.location.assign(urls[1]);}

submitBtn.onclick=()=>{if(!(USER_KEY&&CONFIRMED)){toast("Isi identitas");return;}const cart=loadCart();if(!Object.keys(cart).length){toast("Kosong");return;}const [n,t]=USER_KEY.split("_");const now=new Date();const tot=Object.values(cart).reduce((a,v)=>a+v.qty*v.price,0);const noBon="BON-"+Date.now();const items=Object.entries(cart).map(([id,v])=>{const s=SETS.find(x=>x.id===id);return {title:s.title,qty:v.qty,price:v.price,subtotal:v.qty*v.price};});sendToSheet(SCRIPT_URL,{noBon,nama:n,telp:t,items,total:tot});let msg=`Pesanan Baruüö®%0ANama:${n}%0ATelp:${t}%0A`;items.forEach((it,i)=>msg+=`${i+1}. ${it.title} ${it.qty}x${formatIDR(it.price)}%0A`);msg+=`Total:${formatIDR(tot)}`;openWhatsApp(WA_NUMBER,encodeURIComponent(msg));setTimeout(()=>{const w=window.open("","_blank");if(w){w.document.write(`<h2>Bon Pesanan</h2><p>No:${noBon}</p>`);w.document.close();}},700);localStorage.removeItem(lsKey());render();renderCart();updateBadge();closeCart();};

render();updateBadge();
</script>
</body>
</html>
