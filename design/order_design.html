<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Tuic Desain Kaos</title>
<style>
:root{--bg:#0f1115;--card:#171922;--fg:#e8eefc;--muted:#9aa7c7;--line:#23283a}
*{box-sizing:border-box}
body{margin:0;background:var(--bg);color:var(--fg);font:500 15px/1.55 system-ui,Segoe UI,Inter,Arial}
.wrap{max-width:1200px;margin:auto;padding:22px}
h1{font:800 20px;margin:0}

/* kontak bar */
.contactbar{display:flex;gap:10px;align-items:center;margin-top:10px;background:#0f1320;border:1px solid #2b3a66;border-radius:12px;padding:10px 12px}
.contactbar a{display:inline-flex;align-items:center;gap:8px;text-decoration:none;color:#d1ffe2;background:#1c3b2a;border:1px solid #2d6a4f;border-radius:10px;padding:8px 12px;font-weight:700}
.contactbar .num{color:#9fe6b1;font-weight:700}

/* form */
.formbox{background:var(--card);border:1px solid var(--line);border-radius:12px;padding:12px;margin:16px 0;display:flex;flex-wrap:wrap;gap:12px;align-items:flex-start}
.formbox input{flex:1;min-width:180px;padding:10px 12px;border-radius:8px;border:1px solid #26304f;background:#0f1320;color:var(--fg)}
.btn{border:1px solid #26304f;background:#0f1320;color:#dce6ff;border-radius:10px;padding:10px 14px;cursor:pointer}
.hint{font-size:12px;color:#9aa7c7;margin-top:-6px}
.error{font-size:12px;color:#ff8a8a;margin-top:-6px;display:none}
.oktag{display:none;align-items:center;gap:6px;background:#0c1f12;border:1px solid #1f5f3a;color:#b7ffd2;padding:6px 10px;border-radius:999px}
.cartBtn{position:relative}
.badge{display:none;position:absolute;top:-8px;right:-8px;background:#ef4444;color:#fff;border:2px solid #0f1320;border-radius:999px;font:700 11px/1 system-ui;padding:2px 6px}

/* tabel */
.card{background:var(--card);border:1px solid var(--line);border-radius:14px;padding:10px 12px}
.table{width:100%;border-collapse:collapse}
.th,.td{padding:12px;border-bottom:1px solid var(--line);vertical-align:middle}
.th{color:#aab6da;text-transform:uppercase;font-size:12px}
.no{width:56px;text-align:center}
.title{font-weight:800}
.thumb{width:120px;height:120px;border-radius:10px;overflow:hidden;background:#0e1018;border:1px solid #26304f;display:grid;place-items:center;cursor:pointer}
.thumb img{width:100%;height:100%;object-fit:cover}
.pick{text-align:center;width:90px}
.disabled-note{font-size:12px;color:#ff9b9b;margin-top:6px}

/* panel keranjang + backdrop */
.backdrop{position:fixed;inset:0;background:rgba(0,0,0,.5);display:none;z-index:9000}
.backdrop.show{display:block}
.cart-panel{position:fixed;inset:0 0 0 auto;max-width:420px;transform:translateX(110%);transition:.25s;background:#0f1115;border-left:1px solid #26304f;z-index:9010;display:flex;flex-direction:column}
.cart-panel.open{transform:translateX(0)}
.cart-head{display:flex;align-items:center;justify-content:space-between;padding:14px;border-bottom:1px solid #26304f}
.cart-body{padding:12px;overflow:auto;flex:1}
.cart-row{display:grid;grid-template-columns:64px 1fr 70px;gap:10px;align-items:center;padding:10px 0;border-bottom:1px dashed #2b3350}
.cart-thumb{width:64px;height:64px;border-radius:10px;overflow:hidden;border:1px solid #26304f;background:#101422}
.cart-thumb img{width:100%;height:100%;object-fit:cover}
.cart-foot{padding:12px;border-top:1px solid #26304f}
.total{display:flex;align-items:center;justify-content:space-between;font-weight:800;margin-bottom:10px}
.btn-primary{background:linear-gradient(135deg,#3b82f6,#22c55e);border:none;color:#fff;width:100%}
.xbtn{cursor:pointer;color:#ff9b9b;border:1px solid #5b2b2b;background:#1a0d0d;border-radius:8px;padding:6px 8px;width:100%}

/* lightbox */
.lightbox{position:fixed;inset:0;background:rgba(0,0,0,.88);display:none;align-items:center;justify-content:center;z-index:9500}
.lightbox.show{display:flex}
.lb-inner{position:relative;max-width:94vw}
.lightbox .close{position:absolute;top:-48px;right:0;background:#1b2339;color:#eaf2ff;border:1px solid #2b3a66;border-radius:10px;padding:8px 12px;cursor:pointer}
.lb-main{display:flex;align-items:center;gap:10px}
.lb-main img{max-width:86vw;max-height:70vh;border-radius:12px}
.nav{width:42px;height:42px;border-radius:999px;background:#1b2339;color:#eaf2ff;display:grid;place-items:center;cursor:pointer}
.thumbs{display:flex;gap:8px;justify-content:center;margin-top:12px;flex-wrap:wrap}
.thumbs img{width:72px;height:72px;object-fit:cover;border-radius:8px;opacity:.7;cursor:pointer;border:2px solid transparent}
.thumbs img.active{opacity:1;border-color:#3b82f6}

/* toast */
.toast{position:fixed;top:14px;right:14px;background:#1b2339;color:#eaf2ff;padding:10px 14px;border-radius:10px;z-index:9600;opacity:0;transform:translateY(-10px);transition:.2s}
.toast.show{opacity:1;transform:translateY(0)}

@media (max-width:760px){
  thead{display:none}
  .table, tbody, .row, .td{display:block;width:100%}
  .row{border:1px solid var(--line);border-radius:12px;margin:10px 0}
  .td{border-bottom:1px solid var(--line)}
  .td:last-child{border-bottom:none}
  .thumb{width:100%;height:0;padding-bottom:60%;position:relative}
  .thumb img{position:absolute;inset:0;width:100%;height:100%;object-fit:cover}
}
</style>
</head>
<body>
<div class="wrap">
  <h1>Order Desain Kaos</h1>

  <!-- bar kontak -->
  <div class="contactbar">
    <a id="ctaWA" href="https://wa.me/628161472405" target="_blank" rel="noopener" aria-label="Chat via WhatsApp 0816-1472-405">üí¨ Chat via WhatsApp</a>
    <div>WA: <span class="num">0816-1472-405</span></div>
  </div>

  <!-- identitas -->
  <div class="formbox">
    <div style="flex:1;min-width:220px">
      <input id="nama" placeholder="Nama Pemesan" autocomplete="name"/>
      <div class="hint">Isi nama lengkap</div>
    </div>
    <div style="flex:1;min-width:220px">
      <input id="telp" placeholder="No. Telp / WA (10‚Äì15 digit angka)" inputmode="numeric"/>
      <div id="telpErr" class="error">No. telp salah (10‚Äì15 digit angka)</div>
    </div>
    <div style="display:flex;gap:8px;align-items:center">
      <button id="okBtn" type="button" class="btn">OK</button>
      <div id="okTag" class="oktag">‚úîÔ∏è Terverifikasi</div>
    </div>

    <button id="cartBtn" type="button" class="btn cartBtn" style="margin-left:auto">
      üß∫ Keranjang <span id="cartBadge" class="badge">0</span>
    </button>
    <span id="capInfo" class="hint" style="margin-left:8px">0/12 dipilih</span>
  </div>

  <!-- list tabel -->
  <section id="listTableSection" class="card">
    <table class="table">
      <thead><tr><th class="th no">No</th><th class="th">Judul</th><th class="th">Gambar Belakang</th><th class="th pick">Pilih</th></tr></thead>
      <tbody id="tbody"></tbody>
    </table>
  </section>

  <!-- pesan limit -->
  <section id="limitMsg" class="card" style="display:none;text-align:center">
    <strong>Maksimal 12 gambar tercapai.</strong>
    <div class="hint" style="margin-top:6px">Hapus sebagian di keranjang untuk pilih gambar lain.</div>
    <div style="margin-top:10px">
      <button id="openCartFromMsg" type="button" class="btn">Kelola Keranjang</button>
    </div>
  </section>
</div>

<!-- keranjang -->
<div id="backdrop" class="backdrop"></div>
<aside id="cartPanel" class="cart-panel" aria-hidden="true">
  <div class="cart-head"><strong>Pesanan</strong><button id="closeCart" type="button" class="btn">Tutup</button></div>
  <div id="cartBody" class="cart-body"></div>
  <div class="cart-foot">
    <div class="total"><span>Total</span><span id="grand">Rp 0</span></div>
    <button id="submitBtn" type="button" class="btn btn-primary">Submit & Cetak PDF + WA</button>
    <div class="hint" style="margin-top:8px;text-align:center">Maksimum 12 gambar per pesanan</div>
  </div>
</aside>

<!-- lightbox -->
<div id="lightbox" class="lightbox" aria-hidden="true">
  <div class="lb-inner">
    <button class="close" id="lbClose" type="button">Tutup ‚úï</button>
    <div class="lb-main">
      <div id="lbPrev" class="nav">‚ü®</div>
      <img id="lbImg" alt="preview">
      <div id="lbNext" class="nav">‚ü©</div>
    </div>
    <div id="lbThumbs" class="thumbs"></div>
  </div>
</div>

<!-- Fallback WA -->
<div id="waFallback" style="
  position:fixed;left:12px;right:12px;bottom:12px;z-index:9600;
  display:none;gap:10px;align-items:center;justify-content:space-between;
  background:#0f1320;border:1px solid #2b3a66;color:#eaf2ff;border-radius:12px;
  padding:10px 12px;box-shadow:0 10px 30px rgba(0,0,0,.4);">
  <div>WhatsApp tidak terbuka otomatis. Tap tombol ini:</div>
  <a id="waFallbackBtn" href="#" target="_blank" rel="noopener" style="
     background:#22c55e;color:#fff;font-weight:700;
     padding:10px 14px;border-radius:10px;text-decoration:none;">Buka WhatsApp</a>
</div>

<div id="toast" class="toast"></div>

<script>
/* ========= KONFIG ========= */
const SETS = [
  {
    id:"set-nothing",
    title:"Nothing is Imposible",
    logo:"./gambar/Nothing_Logo.png",
    back:"./gambar/Nothing_Back.png",
    mockup:"./gambar/Nothing_Mockup.png"
  }
  // tambah set lain di sini‚Ä¶
];
const PRICE      = 30000;
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycby20E4jQz5pGqSn0atadu1QGSVaUVXStt8GYiNnBlKvr-eyU-fz7cJJXRxxQqKkMLDSLw/exec"; // ganti

/* GANTI: nomor WA digunakan untuk submit & tombol CTA */
const WA_NUMBER  = "628161472405"; // 08161472405 -> 62 816 1472 405

/* ========= STATE & UTILS ========= */
const MAX_PICK = 12; // BATAS MAKS 12

let USER_KEY=null, CONFIRMED=false;
const lsKey=()=>`orderCart_${USER_KEY}`;
const loadCart=()=>JSON.parse(localStorage.getItem(lsKey())||"{}");
const saveCart=c=>localStorage.setItem(lsKey(),JSON.stringify(c));
const cartCount=()=>Object.values(loadCart()).reduce((a,v)=>a+(v.qty||0),0);
const formatIDR=n=>new Intl.NumberFormat('id-ID',{style:'currency',currency:'IDR',maximumFractionDigits:0}).format(n);
const validTelp=t=>/^\d{10,15}$/.test(t);
function toast(m){const t=document.getElementById('toast');t.textContent=m;t.classList.add('show');setTimeout(()=>t.classList.remove('show'),1800);}
function updateBadge(){const b=document.getElementById('cartBadge');const c=(USER_KEY&&CONFIRMED)?cartCount():0;b.style.display=c>0?'inline-block':'none';b.textContent=c;}
const capInfo = document.getElementById('capInfo');
function updateCapInfo(){
  const picked = (USER_KEY && CONFIRMED) ? cartCount() : 0;
  if (capInfo) capInfo.textContent = `${picked}/${MAX_PICK} dipilih`;
}

/* ========= LIGHTBOX ========= */
const lb=document.getElementById('lightbox'), lbImg=document.getElementById('lbImg'),
      lbThumbs=document.getElementById('lbThumbs'), lbPrev=document.getElementById('lbPrev'),
      lbNext=document.getElementById('lbNext'), lbClose=document.getElementById('lbClose');
let lbList=[], lbIndex=0;
function imgsFor(s){const a=[s.back]; if(s.logo) a.unshift(s.logo); if(s.mockup) a.push(s.mockup); return [...new Set(a.filter(Boolean))];}
function openLightbox(list,start=0){lbList=list;lbIndex=start;setLb();thumbs();lb.classList.add('show');}
function closeLightbox(){lb.classList.remove('show');lbList=[];lbIndex=0;lbImg.src="";}
function setLb(){lbImg.src=lbList[lbIndex];}
function thumbs(){lbThumbs.innerHTML="";lbList.forEach((src,i)=>{const im=new Image();im.src=src;if(i===lbIndex)im.classList.add('active');im.onclick=()=>{lbIndex=i;setLb();thumbs();};lbThumbs.appendChild(im);});}
lbPrev.onclick=()=>{if(!lbList.length)return;lbIndex=(lbIndex-1+lbList.length)%lbList.length;setLb();thumbs();};
lbNext.onclick=()=>{if(!lbList.length)return;lbIndex=(lbIndex+1)%lbList.length;setLb();thumbs();};
lbClose.onclick=closeLightbox; lb.addEventListener('click',e=>{if(e.target===lb)closeLightbox();});
document.addEventListener('keydown',e=>{if(e.key==='Escape'){closeLightbox(); closeCart();}});

/* ========= RENDER LIST ========= */
const tbody=document.getElementById('tbody');
const listTableSection=document.getElementById('listTableSection');
const limitMsg=document.getElementById('limitMsg');

function render(){
  const cart=(USER_KEY&&CONFIRMED)?loadCart():{};
  tbody.innerHTML=""; let no=0;

  const pickedCount = (USER_KEY&&CONFIRMED)?cartCount():0;
  const maxReached  = pickedCount >= MAX_PICK;

  // Toggle section: jika sudah 12 -> sembunyikan tabel, tampilkan pesan
  if (maxReached){
    if(listTableSection) listTableSection.style.display='none';
    if(limitMsg) limitMsg.style.display='block';
    updateCapInfo();
    return;
  } else {
    if(listTableSection) listTableSection.style.display='block';
    if(limitMsg) limitMsg.style.display='none';
  }

  SETS.forEach(s=>{
    if(cart[s.id]) return; no++;
    const disabled=!(USER_KEY&&CONFIRMED); // saat belum konfirmasi data

    const tr=document.createElement('tr');
    tr.innerHTML=`
      <td class="td no">${no}</td>
      <td class="td"><div class="title">${s.title}</div><div style="color:#9aa7c7">ID: ${s.id}</div></td>
      <td class="td"><div class="thumb"><img src="${s.back}" alt="${s.title}"/></div></td>
      <td class="td pick">
        <input type="checkbox" data-id="${s.id}" ${disabled?'disabled':''}>
        ${disabled?'<div class="disabled-note">Klik OK dulu</div>':`<div class="hint">Sisa bisa pilih: ${MAX_PICK - pickedCount}</div>`}
      </td>`;
    tbody.appendChild(tr);
    tr.querySelector('.thumb').onclick=()=>openLightbox(imgsFor(s),0);
  });

  tbody.querySelectorAll('input[type=checkbox]').forEach(cb=>{
    cb.onchange=()=>{
      if(cartCount() >= MAX_PICK){
        cb.checked=false;
        toast('Maksimal 12 gambar per pesanan.');
        render();
        return;
      }
      const id=cb.dataset.id; const c=loadCart(); c[id]={qty:1,price:PRICE}; saveCart(c);
      render(); renderCart(); updateBadge(); updateCapInfo(); toast('Ditambahkan ke keranjang');
    };
  });

  updateCapInfo();
}

/* ========= IDENTITAS ========= */
const namaEl=document.getElementById('nama'), telpEl=document.getElementById('telp'), errEl=document.getElementById('telpErr'), okTag=document.getElementById('okTag');
document.getElementById('okBtn').onclick=()=>{
  const n=namaEl.value.trim(), t=telpEl.value.trim();
  if(!n){toast('Nama belum diisi');return;}
  if(!validTelp(t)){errEl.style.display='block';toast('No. telp salah');return;}
  errEl.style.display='none'; USER_KEY=n.replace(/\s+/g,'_')+'_'+t; CONFIRMED=true; okTag.style.display='inline-flex';
  render(); updateBadge(); updateCapInfo(); toast('Identitas OK. Pilih barang.');
};

/* ========= KERANJANG ========= */
const cartPanel=document.getElementById('cartPanel'), backdrop=document.getElementById('backdrop');
function openCart(){renderCart();cartPanel.classList.add('open');backdrop.classList.add('show');}
function closeCart(){cartPanel.classList.remove('open');backdrop.classList.remove('show');}
document.getElementById('cartBtn').onclick=openCart;
document.getElementById('closeCart').onclick=closeCart;
backdrop.onclick=closeCart;
document.getElementById('openCartFromMsg').onclick=openCart;

function renderCart(){
  const c=(USER_KEY)?loadCart():{}; const body=document.getElementById('cartBody'); body.innerHTML=""; let total=0;
  Object.entries(c).forEach(([id,{qty,price}])=>{
    const s=SETS.find(x=>x.id===id); total+=qty*price;
    body.insertAdjacentHTML('beforeend',`
      <div class="cart-row">
        <div class="cart-thumb"><img src="${s.back}" alt="${s.title}"/></div>
        <div><div style="font-weight:800">${s.title}</div><div style="color:#9aa7c7">Qty: ${qty} √ó ${formatIDR(price)}</div></div>
        <div><button class="xbtn" data-del="${id}">Hapus</button></div>
      </div>`);
  });
  if(!Object.keys(c).length) body.innerHTML="<p style='color:#9aa7c7'>Keranjang kosong</p>";
  document.getElementById('grand').textContent=formatIDR(total);
  body.querySelectorAll('[data-del]').forEach(b=>b.onclick=()=>{
    const cc=loadCart(); delete cc[b.dataset.del]; saveCart(cc);
